/* ------------------------------------------------------------------------
	* LCweb text shortener
	*
	* @version: 	1.1
	* @requires:	jQuery v1.5 or later
	* @author:		Luca Montanari (LCweb) (http://projects.lcweb.it)
	
	* Licensed under the MIT license
------------------------------------------------------------------------- */

(function(a){a.fn.lcweb_txt_shortener=function(g,d,p,q){var n=a(this);"undefined"==typeof lcts_orig_texts&&(lcts_orig_texts=a.makeArray());"undefined"==typeof g&&(g="..");a.fn.lcts_remove_all_attr=function(){return this.each(function(){var b=a.map(this.attributes,function(a){return a.name}),c=a(this);a.each(b,function(a,b){"href"!=b&&"target"!=b&&c.removeAttr(b)})})};return function(){n.each(function(){var b=a(this),c=a(this).attr("lcts-id");"undefined"==typeof c?(c=Math.random().toString(36).substr(2, 9),a(this).attr("lcts-id",c),lcts_orig_texts[c]=b.html()):(b.html(lcts_orig_texts[c]),b.removeClass("lcts_shorten"));b.find("*:empty").not("br, img, i").remove();var c=b.outerHeight(!0),e="undefined"!=typeof d&&d?parseInt(d):b.parent().height();"undefined"!=typeof d&&parseInt(d)>e&&(e=parseInt(d));if(e<c){b.html();b.addClass("lcts_shorten");b.find("*").lcts_remove_all_attr();b.find("*").not("a, p, br, i:empty").each(function(){var b=a(this).contents();a(this).replaceWith(b)});for(var l=b.html().split(" "), h="",f="",k=c=0;c<e&&k<l.length;)if("undefined"!=typeof l[k]){f=h;h=h+l[k]+" ";for(b.html(h+' <span class="lcts_end_txt">'+g+"</span>");-1!=b.html().indexOf('<br> <span class="lcts_end_txt">');)b.find(".lcts_end_txt").prev().remove();c=b.outerHeight(!0);k++}var m=["a","p","i"];a.each(m,function(a,c){var d=f.match("<"+c,"g"),e=f.match("</"+c,"g");null!=d&&(null!=d&&null==e||d.length>e.length)&&(f=f+"</"+c+">");if(a==m.length-1)for(b.html(f+'<span class="lcts_end_txt">'+g+"</span>"),b.find("*:empty").not("br").remove();-1!= b.html().indexOf('<br> <span class="lcts_end_txt">');)b.find(".lcts_end_txt").prev().remove()});b.find("p").last().css("display","inline")}})}()};a.fn.lcts_reset=function(){a(this).each(function(){"undefined"!=typeof lcts_orig_texts&&"undefined"!=typeof a(this).attr("lcts-id")&&(a(this).removeClass("lcts_shorten"),a(this).html(lcts_orig_texts[a(this).attr("lcts-id")]))})};a.fn.lcts_destroy=function(){a(this).each(function(){"undefined"!=typeof lcts_orig_texts&&"undefined"!=typeof a(this).attr("lcts-id")&& (a(this).removeClass("lcts_shorten"),a(this).html(lcts_orig_texts[a(this).attr("lcts-id")]),a(this).removeAttr("lcts-id"),lcts_orig_texts.splice(a(this).attr("lcts-id"),1))})}})(jQuery);